<div class="modal-overlay" *ngIf="visible" (click)="onCerrar()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        <i class="fas fa-shield-alt"></i>
        Aplicar Medidas de Seguridad
      </h2>
      <button class="btn-close" (click)="onCerrar()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="modal-body">
      <!-- Información de la ficha -->
      <div class="ficha-info">
        <h3>Ficha: {{ folioFicha }}</h3>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Delegación:</span>
            <span class="value">{{ delegacion }}</span>
          </div>
          <div class="info-item">
            <span class="label">Municipio:</span>
            <span class="value">{{ municipio }}</span>
          </div>
          <div class="info-item">
            <span class="label">Lugar:</span>
            <span class="value">{{ lugar }}</span>
          </div>
          <div class="info-item">
            <span class="label">Prioridad:</span>
            <span class="value">
              <span
                class="badge-prioridad"
                [ngClass]="getPrioridadClass(prioridad)"
              >
                {{ prioridad }}
              </span>
            </span>
          </div>
        </div>
      </div>

      <!-- Medidas de seguridad -->
      <div class="medidas-section">
        <h3>Seleccione las medidas de seguridad a aplicar:</h3>

        <div *ngIf="medidasSeguridad.length === 0" class="alert-warning">
          <i class="fas fa-exclamation-triangle"></i>
          <p>
            No se pudieron cargar las medidas de seguridad. Verifique que el
            backend esté corriendo.
          </p>
        </div>

        <div class="medidas-list" *ngIf="medidasSeguridad.length > 0">
          <label
            *ngFor="let medida of medidasSeguridad"
            class="medida-checkbox"
          >
            <input
              type="checkbox"
              [(ngModel)]="medidasSeleccionadasMap[medida.idCatMedida]"
            />
            <span class="checkmark"></span>
            <span class="medida-nombre">{{ medida.medida }}</span>
          </label>
        </div>
      </div>

      <!-- Comentarios -->
      <div class="comentario-section">
        <h3>Comentarios adicionales:</h3>
        <textarea
          class="comentario-textarea"
          [(ngModel)]="comentario"
          placeholder="Ingrese observaciones o detalles sobre las medidas a aplicar..."
          rows="4"
        ></textarea>
      </div>

      <!-- Resumen de medidas seleccionadas -->
      <div class="resumen-section" *ngIf="medidasSeleccionadasCount > 0">
        <h4>Medidas seleccionadas ({{ medidasSeleccionadasCount }}):</h4>
        <ul>
          <li *ngFor="let medida of getMedidasSeleccionadasList()">
            <i class="fas fa-check-circle"></i>
            {{ medida.medida }}
          </li>
        </ul>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-cancelar" (click)="onCerrar()">
        <i class="fas fa-times"></i>
        Cancelar
      </button>
      <button
        class="btn-aplicar"
        (click)="onAplicar()"
        [disabled]="medidasSeleccionadasCount === 0"
      >
        <i class="fas fa-check"></i>
        Aplicar Medidas
      </button>
    </div>
  </div>
</div>

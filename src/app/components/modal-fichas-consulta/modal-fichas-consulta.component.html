<!-- Modal para ver/editar ficha -->
<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>
        üìã Ficha Informativa{{ modoSoloLectura ? " (Solo Lectura)" : "" }} - ID:
        {{ fichaSeleccionada?.id }}
      </h2>
      <button class="btn-close-modal" (click)="cerrarModal()">‚úñ</button>
    </div>

    <div class="modal-body" *ngIf="cargandoFicha">
      <p class="cargando-ficha">Cargando informaci√≥n de la ficha...</p>
    </div>

    <div
      class="modal-body"
      [class.solo-lectura]="modoSoloLectura"
      *ngIf="!cargandoFicha && fichaSeleccionada"
    >
      <div class="ficha-grid">
        <!-- Secci√≥n 1: Informaci√≥n General -->
        <div class="ficha-section">
          <h3>üìç Informaci√≥n General</h3>
          <div class="ficha-field">
            <label>C√©dula:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.cedula"
              placeholder="Ingrese c√©dula"
            />
          </div>
          <div class="ficha-field">
            <label>Delegaci√≥n:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.delegacion"
              placeholder="Ingrese delegaci√≥n"
            />
          </div>
          <div class="ficha-field">
            <label>Municipio:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.municipio"
              placeholder="Ingrese municipio"
            />
          </div>
          <div class="ficha-field">
            <label>Lugar:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.lugar"
              placeholder="Ingrese lugar"
            />
          </div>
          <div class="ficha-field">
            <label>Direcci√≥n:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.direccion"
              placeholder="Ingrese direcci√≥n"
            />
          </div>
          <div class="ficha-field">
            <label>Latitud:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.latitud"
              placeholder="Ingrese latitud"
            />
          </div>
          <div class="ficha-field">
            <label>Longitud:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.longitud"
              placeholder="Ingrese longitud"
            />
          </div>
        </div>

        <!-- Secci√≥n 2: Fecha y Hora del Suceso -->
        <div class="ficha-section">
          <h3>üïê Fecha y Hora del Suceso</h3>
          <div class="ficha-field">
            <label>Fecha del Suceso:</label>
            <input type="date" [(ngModel)]="fichaSeleccionada.fechaSuceso" />
          </div>
          <div class="ficha-field">
            <label>Hora Inicio:</label>
            <input
              type="time"
              [(ngModel)]="fichaSeleccionada.horaSucesoInicio"
            />
          </div>
          <div class="ficha-field">
            <label>Hora Fin:</label>
            <input type="time" [(ngModel)]="fichaSeleccionada.horaSucesoFin" />
          </div>
        </div>

        <!-- Secci√≥n 3: Clasificaci√≥n -->
        <div class="ficha-section">
          <h3>üè∑Ô∏è Clasificaci√≥n</h3>
          <div class="ficha-field">
            <label>Sector:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.sector"
              placeholder="Ingrese sector"
            />
          </div>
          <div class="ficha-field">
            <label>Subsector:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.subsector"
              placeholder="Ingrese subsector"
            />
          </div>
          <div class="ficha-field">
            <label>Prioridad:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.prioridad"
              placeholder="Ingrese prioridad"
            />
          </div>
          <div class="ficha-field">
            <label>Condici√≥n:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.condicion"
              placeholder="Ingrese condici√≥n"
            />
          </div>
          <div class="ficha-field">
            <label>N√∫mero de Asistentes:</label>
            <input
              type="number"
              [(ngModel)]="fichaSeleccionada.numAsistentes"
              placeholder="0"
            />
          </div>
        </div>

        <!-- Secci√≥n 4: Elaboraci√≥n y Recepci√≥n -->
        <div class="ficha-section">
          <h3>üìÖ Elaboraci√≥n y Recepci√≥n</h3>
          <div class="ficha-field">
            <label>Fecha Elaboraci√≥n:</label>
            <input
              type="date"
              [(ngModel)]="fichaSeleccionada.fechaElaboracion"
            />
          </div>
          <div class="ficha-field">
            <label>Hora Elaboraci√≥n:</label>
            <input
              type="time"
              [(ngModel)]="fichaSeleccionada.horaElaboracion"
            />
          </div>
          <div class="ficha-field">
            <label>Fecha Recepci√≥n:</label>
            <input type="date" [(ngModel)]="fichaSeleccionada.fechaRecepcion" />
          </div>
          <div class="ficha-field">
            <label>Hora Recepci√≥n:</label>
            <input type="time" [(ngModel)]="fichaSeleccionada.horaRecepcion" />
          </div>
          <div class="ficha-field">
            <label>Folio Interno:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.folioInterno"
              placeholder="Ingrese folio"
            />
          </div>
        </div>

        <!-- Secci√≥n 5: Descripci√≥n -->
        <div class="ficha-section full-width">
          <h3>üìù Descripci√≥n</h3>
          <div class="ficha-field">
            <label>Informaci√≥n:</label>
            <textarea
              [(ngModel)]="fichaSeleccionada.informacion"
              rows="4"
              placeholder="Ingrese informaci√≥n"
            ></textarea>
          </div>
          <div class="ficha-field">
            <label>Asunto:</label>
            <textarea
              [(ngModel)]="fichaSeleccionada.asunto"
              rows="4"
              placeholder="Ingrese asunto"
            ></textarea>
          </div>
          <div class="ficha-field">
            <label>Hechos:</label>
            <textarea
              [(ngModel)]="fichaSeleccionada.hechos"
              rows="4"
              placeholder="Ingrese hechos"
            ></textarea>
          </div>
          <div class="ficha-field">
            <label>Acuerdos:</label>
            <textarea
              [(ngModel)]="fichaSeleccionada.acuerdos"
              rows="4"
              placeholder="Ingrese acuerdos"
            ></textarea>
          </div>
        </div>

        <!-- Secci√≥n 6: Responsables -->
        <div class="ficha-section">
          <h3>üë• Responsables</h3>
          <div class="ficha-field">
            <label>ID Usuario:</label>
            <input
              type="number"
              [(ngModel)]="fichaSeleccionada.idUsuario"
              placeholder="0"
            />
          </div>
          <div class="ficha-field">
            <label>ID Inform√≥:</label>
            <input
              type="number"
              [(ngModel)]="fichaSeleccionada.idInformo"
              placeholder="0"
            />
          </div>
          <div class="ficha-field">
            <label>ID Autoriz√≥:</label>
            <input
              type="number"
              [(ngModel)]="fichaSeleccionada.idAutorizo"
              placeholder="0"
            />
          </div>
          <div class="ficha-field">
            <label>Estado Actual:</label>
            <input
              type="number"
              [(ngModel)]="fichaSeleccionada.idEstadoActual"
              placeholder="0"
            />
          </div>
          <div class="ficha-field">
            <label>Activo:</label>
            <input
              type="number"
              [(ngModel)]="fichaSeleccionada.activo"
              placeholder="0"
            />
          </div>
          <div class="ficha-field">
            <label>Visto:</label>
            <input
              type="number"
              [(ngModel)]="fichaSeleccionada.visto"
              placeholder="0"
            />
          </div>
        </div>

        <!-- Secci√≥n 7: Informaci√≥n Adicional -->
        <div class="ficha-section">
          <h3>üìå Informaci√≥n Adicional</h3>
          <div class="ficha-field">
            <label>Motivo Cancelaci√≥n:</label>
            <input
              type="text"
              [(ngModel)]="fichaSeleccionada.motivoCancelacion"
              placeholder="Ingrese motivo de cancelaci√≥n"
            />
          </div>
          <div class="ficha-field">
            <label>ID Ficha Anterior:</label>
            <input
              type="number"
              [(ngModel)]="fichaSeleccionada.idFichaAnterior"
              placeholder="0"
            />
          </div>
          <div class="ficha-field">
            <label>Fecha Validaci√≥n:</label>
            <input
              type="datetime-local"
              [(ngModel)]="fichaSeleccionada.fechaValidacion"
            />
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-cancelar" (click)="cerrarModal()">
        {{ modoSoloLectura ? "Cerrar" : "Cancelar" }}
      </button>
      <button
        *ngIf="!modoSoloLectura"
        class="btn-validar"
        (click)="onValidarYGuardar()"
        [disabled]="cargandoFicha"
      >
        ‚úÖ Validar y Guardar
      </button>
    </div>
  </div>
</div>
